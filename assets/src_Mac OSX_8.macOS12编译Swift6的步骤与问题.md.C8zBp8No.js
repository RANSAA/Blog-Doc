import{_ as a,c as n,o as e,ag as t}from"./chunks/framework.Bee44SUS.js";const u=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"src/Mac OSX/8.macOS12编译Swift6的步骤与问题.md","filePath":"src/Mac OSX/8.macOS12编译Swift6的步骤与问题.md","lastUpdated":1770199621000}'),i={name:"src/Mac OSX/8.macOS12编译Swift6的步骤与问题.md"};function p(l,s,c,o,r,d){return e(),n("div",null,[...s[0]||(s[0]=[t(`<h2 id="macos12编译swift6的步骤与问题" tabindex="-1">macOS12编译Swift6的步骤与问题 <a class="header-anchor" href="#macos12编译swift6的步骤与问题" aria-label="Permalink to &quot;macOS12编译Swift6的步骤与问题&quot;">​</a></h2><h2 id="⚠️⚠️⚠️警告⚠️⚠️⚠️" tabindex="-1">⚠️⚠️⚠️警告⚠️⚠️⚠️ <a class="header-anchor" href="#⚠️⚠️⚠️警告⚠️⚠️⚠️" aria-label="Permalink to &quot;⚠️⚠️⚠️警告⚠️⚠️⚠️&quot;">​</a></h2><p>后面的不用看，也不应该在macOS12上自行编译Swift6，因为Swift6中除了Swift编译器，很多工具如<code>Swift Package Manager</code>都依赖macOS13+上面的API。</p><p>在macOS12上即使将这些工具都成功编译，但在macOS12上使用也会有问题，并且只能使用Swift核心部分，如:<code>swift</code>,<code>swiftc</code>等工具。</p><p>所有直接下载Apple提供的Swift6+工具链即可，在macOS12上只使用它的<code>swift</code>,<code>swiftc</code>等工具即可。</p><p>总结：在macOS12上编译Swift6+的思路就是错的，纯纯的浪费时间，啥也不是。</p><h2 id="" tabindex="-1"><a class="header-anchor" href="#" aria-label="Permalink to &quot;&quot;">​</a></h2><h2 id="-1" tabindex="-1"><a class="header-anchor" href="#-1" aria-label="Permalink to &quot;&quot;">​</a></h2><h2 id="使用场景" tabindex="-1">使用场景 <a class="header-anchor" href="#使用场景" aria-label="Permalink to &quot;使用场景&quot;">​</a></h2><p>由于macOS只能升级到macOS 12.7.5，导致Xcode只能升级到Xcode 14.2；其中Swift版本为Swift 5.7.2。现在想使用Siwft 6或者 <br> 更高的版本，所有只能尝试在macOS 12.7.5(macOS Monterey)上编译Swift 6+，看是否能正常编译和正常使用。并且编译的Swift 6+ <br> 可能功能不全，只能使用swift Package Manager的方式创建应用，且可能不能使用其中与iOS，macOS，tvOS相关的SDK,或者说编译生成 <br> 的Swift 6+中的iOS 等SDK与macOS平台不匹配。并且所有自己编译的Swift版本不能上架到App Store（上架需要与Xcode绑定的Swift，<br> 或者需要升级到最新版本的Xcode才能上架）。 <br> 总之在低版本的macOS上编译的高版本的Swift，使用时可能会有一些问题，但是编译Swift package manager(例如命令行工具)方式的程序应该没问题。</p><h2 id="-2" tabindex="-1"><a class="header-anchor" href="#-2" aria-label="Permalink to &quot;&quot;">​</a></h2><h2 id="-3" tabindex="-1"><a class="header-anchor" href="#-3" aria-label="Permalink to &quot;&quot;">​</a></h2><h2 id="编译要求" tabindex="-1">编译要求 <a class="header-anchor" href="#编译要求" aria-label="Permalink to &quot;编译要求&quot;">​</a></h2><p>编译Swift6+需要的Swift版本最低为5.8，有由于Xcode 14.2的Swift版本为5.7.2，所以需要安装自定义的工具链。又由于Swift 6.0+的版本在macOS 12 <br> 的系统上无法运行，最后通过测试找到了macOS 12支持的Swift的最高版本为Swift 5.10.1，所有就下载了该版本作为编译Swift 6+的编译工具链，安装自定义工具链 <br> 需要设置工具工具链的路径才能使用指定版本工具链(Xcode中可以通过Toolchains选项切换版本)，设置工具链环境变量方法：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>export TOOLCHAINS=$(plutil -extract CFBundleIdentifier raw /Library/Developer/Toolchains/swift-5.10.1-RELEASE.xctoolchain/Info.plist)</span></span></code></pre></div><p>使用时可能还需要设置它的动态库地址，否者可能出现库找不到的情况，可以尝试下列配置：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>export TOOLCHAINS=$(plutil -extract CFBundleIdentifier raw /Library/Developer/Toolchains/swift-5.10.1-RELEASE.xctoolchain/Info.plist)</span></span>
<span class="line"><span>export CMAKE_Swift_COMPILER=/Library/Developer/Toolchains/swift-5.10.1-RELEASE.xctoolchain/usr/bin/swiftc</span></span></code></pre></div><p>需要安装：ninja sccache</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>brew install ninja sccache</span></span></code></pre></div><p>如果sccache等工具无法安装，则可以到GitHub获取其对应的二进制文件，然后创建软连接，如下:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>#!/usr/bin/env bash </span></span>
<span class="line"><span></span></span>
<span class="line"><span>## 先移除已经存在的软连接</span></span>
<span class="line"><span>rm -rf /usr/local/bin/sccache</span></span>
<span class="line"><span></span></span>
<span class="line"><span>## 创建软连接</span></span>
<span class="line"><span>ln -s /Volumes/ExData/Downloads/dependencies/sccache/bin/sccache /usr/local/bin/sccache</span></span>
<span class="line"><span>echo &quot;swift-dependencies-sccache服务创建成功！&quot;</span></span></code></pre></div><p>如果还有其他的工具无法安装时，也可以使用软连接的方式。</p><p>其它要求与配置可以查看: <a href="https://github.com/swiftlang/swift/blob/main/docs/HowToGuides/GettingStarted.md" target="_blank" rel="noreferrer">swiftlang</a></p><h2 id="-4" tabindex="-1"><a class="header-anchor" href="#-4" aria-label="Permalink to &quot;&quot;">​</a></h2><h2 id="资源" tabindex="-1">资源 <a class="header-anchor" href="#资源" aria-label="Permalink to &quot;资源&quot;">​</a></h2><ul><li><a href="https://github.com/swiftlang/swift" target="_blank" rel="noreferrer">Swift源码</a></li><li><a href="https://www.swift.org/install/macos/" target="_blank" rel="noreferrer">Swfit Previous Releases 下载</a></li><li><a href="https://www.swift.org/install/macos/package_installer/" target="_blank" rel="noreferrer">Toolchains设置方式</a></li></ul><h2 id="-5" tabindex="-1"><a class="header-anchor" href="#-5" aria-label="Permalink to &quot;&quot;">​</a></h2><h2 id="⚠️编译结果注意-⚠️" tabindex="-1">⚠️编译结果注意#⚠️ <a class="header-anchor" href="#⚠️编译结果注意-⚠️" aria-label="Permalink to &quot;⚠️编译结果注意#⚠️&quot;">​</a></h2><p>由于在哪macOS12上编译Swift6存在限制，因为Swift6会使用到macOS13+上系统的库，有些工具如：SwiftPM 即使编译成功也无法使用，因为SwiftPM需要使用macOS13+上面的系统库而导致</p><p>SwiftPM在macOS12上无法使用，而还有些工具又依赖SwiftPM，所以导致这一系列工具都在macOS12上无法使用，然而编译的swift swiftc工具可以在macOS12上使用。</p><p>所以再macOS12上只编译Swift6+的核心库即可，然后直接使用swift swiftc这些工具来体验Swift6+与学习。</p><h2 id="-6" tabindex="-1"><a class="header-anchor" href="#-6" aria-label="Permalink to &quot;&quot;">​</a></h2><h2 id="-7" tabindex="-1"><a class="header-anchor" href="#-7" aria-label="Permalink to &quot;&quot;">​</a></h2><h2 id="⚠️警告⚠️" tabindex="-1">⚠️警告⚠️ <a class="header-anchor" href="#⚠️警告⚠️" aria-label="Permalink to &quot;⚠️警告⚠️&quot;">​</a></h2><p>由于系统原因<code>swiftpm</code>和<code>sourcekit-lsp</code>编译不过，主要是因为这个工具再Swift6+的环境下使用了macOS13+上面的系统API，所以再编译时无法通过，即使通过多种方法，比如: <br> 修改源码的方式，即使有可能编译通过(概率不大)，那么也会有使用问题，所有最简单的办法是<code>直接只编译Swift6的核心库</code>即可，<code>就可以简单的使用Swift6+的功能</code>比如直接使用<code>swift</code> <br><code>swiftc </code>等命令编译执行简单的单个源代码文件程序。<br> 又因为形如<code>swiftpm</code>工具等无法编译通过，那么<code>Swift Package Manager</code>相关工具就无法使用，比如:<code>swift run</code>，<code>swift build</code>，<code>swift test</code>等命令就无法使用。 <br> 或者有更更多的工具也无法使用，或者会出现莫名其妙的问题。<br> 总之：只需要编译Swift6+最核心的库即可，然后简单的使用<code>swift</code>，<code>swiftc</code>命令进行简单的程序测试，Swift6+语法的体验即可。</p><h2 id="-8" tabindex="-1"><a class="header-anchor" href="#-8" aria-label="Permalink to &quot;&quot;">​</a></h2><h2 id="swift-6-编译步骤" tabindex="-1">Swift 6+编译步骤 <a class="header-anchor" href="#swift-6-编译步骤" aria-label="Permalink to &quot;Swift 6+编译步骤&quot;">​</a></h2><ol><li>创建编译目录并进入：</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>mkdir swift</span></span>
<span class="line"><span>cd swift</span></span></code></pre></div><p>因为Swift clone时会有很多同级代码仓库，所有先创建一个总目录swift方便代码管理。</p><ol start="2"><li>从GitHub cloneSwift源代码并进入目录：</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>git clone https://github.com/swiftlang/swift.git</span></span>
<span class="line"><span>cd swift</span></span></code></pre></div><ol start="3"><li>update与checkout Swift的指定版本，当前编译Swift 6.0.0，所以checkout 6.0.0的版本:</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>utils/update-checkout --clone --tag swift-6.0-RELEASE</span></span></code></pre></div><p><strong>⚠️注意⚠️</strong> <br> checkout指定版本很重要，之前由于update-checkout操作不正确，编译前update-checkout了多个版本，导致编译时出现了很多莫名奇妙的问题，而导致Swift 6+编译不通过 <br> 比如先用默认分支编译然后编译失败了，接着尝试update-checkout swift 6.2又失败了，再然后update-checkout swift 6.0还是编译失败了，并且在update-checkout时 <br> 也可能操作失误了，导致尝试了很多次结果依然失败了，而且每次编译Swift都需要号几个小时，就这样整了几天结果还失败了，真是被坑麻了。<br> 后来尝试了从了重新拉取Swift的代码，并且update-checkout 6.0居然一次就编译过了。<br><strong>✅所以✅</strong><br><strong>每次编译不同版本，或者总是编译失败，可以尝试重新clone Swift代码，然后再正确update-checkout指定版本，最后再执行编译操作，这样的编译问题可能就更少。</strong></p><ol start="4"><li>设置编译环境</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>export TOOLCHAINS=$(plutil -extract CFBundleIdentifier raw /Library/Developer/Toolchains/swift-5.10.1-RELEASE.xctoolchain/Info.plist)</span></span></code></pre></div><p>注意：这一步必须设置才能使用使用指定版本的Swift工具链，上面的swift-latest.xctoolchain真实对应的是swift-5.10.1-RELEASE-.xctoolchain版本。</p><ol start="5"><li>执行编译命令:</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>utils/build-script --skip-build-benchmarks \\</span></span>
<span class="line"><span>  --swift-darwin-supported-archs &quot;$(uname -m)&quot; \\</span></span>
<span class="line"><span>  --release-debuginfo --swift-disable-dead-stripping \\</span></span>
<span class="line"><span>  --bootstrapping=hosttools \\</span></span>
<span class="line"><span>  --sccache \\</span></span>
<span class="line"><span>  --install-swift</span></span></code></pre></div><p>或者使用release模式(体积更小)编译:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ReleaseAssertPath=/Volumes/ExData/Downloads/swift/build/Ninja-ReleaseAssert/swift-macosx-x86_64</span></span>
<span class="line"><span>utils/build-script --skip-build-benchmarks \\</span></span>
<span class="line"><span>  --swift-darwin-supported-archs &quot;$(uname -m)&quot; \\</span></span>
<span class="line"><span>  --release --swift-disable-dead-stripping \\</span></span>
<span class="line"><span>  --swift-cmake-options=&quot;-DSWIFT_EXTERNAL_PLUGIN_PATH=\${ReleaseAssertPath}/bin#\${ReleaseAssertPath}/lib/swift/host/plugins#\${ReleaseAssertPath}/bin/swift-plugin-server&quot; \\</span></span>
<span class="line"><span>  --bootstrapping=hosttools \\</span></span>
<span class="line"><span>  --sccache \\</span></span>
<span class="line"><span>  --install-swift</span></span></code></pre></div><p>几种编译模式，它们的体积一次减小：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>--debug</span></span>
<span class="line"><span>--release-debuginfo</span></span>
<span class="line"><span>--release</span></span>
<span class="line"><span>--min-size-release</span></span></code></pre></div><p>✅由于<code>swiftpm</code>,<code>sourcekit-lsp</code>,<code>xctest</code>,<code>swiftdocc</code>等工具<code>无法在macOS12上编译或者正常使用</code>,所以<strong>只需要编译Swift6核心库</strong>，然后直接使用<code>swift swiftc</code>等工具即可。 <br><br> ✅使用<code>--release</code>模式编译可获取较小的二进制文件，生成的XcodeDefault.xctoolchain文件大小约为3.1G。编译命令如下:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ReleaseAssertPath=/Volumes/ExData/Downloads/swift/build/Ninja-ReleaseAssert/swift-macosx-x86_64</span></span>
<span class="line"><span>utils/build-script --skip-build-benchmarks \\</span></span>
<span class="line"><span>  --swift-darwin-supported-archs &quot;$(uname -m)&quot; \\</span></span>
<span class="line"><span>  --release --swift-disable-dead-stripping \\</span></span>
<span class="line"><span>  --swift-cmake-options=&quot;-DSWIFT_EXTERNAL_PLUGIN_PATH=\${ReleaseAssertPath}/bin#\${ReleaseAssertPath}/lib/swift/host/plugins#\${ReleaseAssertPath}/bin/swift-plugin-server&quot; \\</span></span>
<span class="line"><span>  --bootstrapping=hosttools \\</span></span>
<span class="line"><span>  --sccache \\</span></span>
<span class="line"><span>  --install-swift</span></span></code></pre></div><p>✅使用<code>--min-size-release</code>模式编译可获取最小二进制文件，生成的XcodeDefault.xctoolchain文件大小约为2.5G。编译命令如下:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ReleaseAssertPath=/Volumes/ExData/Downloads/swift/build/Ninja-MinSizeRelAssert/swift-macosx-x86_64</span></span>
<span class="line"><span>utils/build-script --skip-build-benchmarks \\</span></span>
<span class="line"><span>  --swift-darwin-supported-archs &quot;$(uname -m)&quot; \\</span></span>
<span class="line"><span>  --min-size-release --swift-disable-dead-stripping \\</span></span>
<span class="line"><span>  --swift-cmake-options=&quot;-DSWIFT_EXTERNAL_PLUGIN_PATH=\${ReleaseAssertPath}/bin#\${ReleaseAssertPath}/lib/swift/host/plugins#\${ReleaseAssertPath}/bin/swift-plugin-server&quot; \\</span></span>
<span class="line"><span>  --bootstrapping=hosttools \\</span></span>
<span class="line"><span>  --sccache \\</span></span>
<span class="line"><span>  --llbuild --install-llbuild \\</span></span>
<span class="line"><span>  --swift-driver --install-swift-driver \\</span></span>
<span class="line"><span>  --install-swift</span></span></code></pre></div><p>✅如果需要编译完整的Swift，比如macOS13+上面编译(可以正常使用)，可以使用下面的编译命令：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ReleaseAssertPath=/Volumes/ExData/Downloads/swift/build/Ninja-ReleaseAssert/swift-macosx-x86_64</span></span>
<span class="line"><span>utils/build-script --skip-build-benchmarks \\</span></span>
<span class="line"><span>  --swift-darwin-supported-archs &quot;$(uname -m)&quot; \\</span></span>
<span class="line"><span>  --release --swift-disable-dead-stripping \\</span></span>
<span class="line"><span>  --swift-cmake-options=&quot;-DSWIFT_EXTERNAL_PLUGIN_PATH=\${ReleaseAssertPath}/bin#\${ReleaseAssertPath}/lib/swift/host/plugins#\${ReleaseAssertPath}/bin/swift-plugin-server&quot; \\</span></span>
<span class="line"><span>  --bootstrapping=hosttools \\</span></span>
<span class="line"><span>  --sccache \\</span></span>
<span class="line"><span>  --install-llvm --install-swift \\</span></span>
<span class="line"><span>  --libcxx --install-libcxx \\</span></span>
<span class="line"><span>  --lldb --install-lldb \\</span></span>
<span class="line"><span>  --playgroundsupport --install-playgroundsupport \\</span></span>
<span class="line"><span>  --llbuild --install-llbuild \\</span></span>
<span class="line"><span>  --swiftpm --install-swiftpm \\</span></span>
<span class="line"><span>  --sourcekit-lsp --install-sourcekit-lsp \\</span></span>
<span class="line"><span>  --swiftdocc --install-swiftdocc \\</span></span>
<span class="line"><span>  --xctest --install-xctest</span></span></code></pre></div><p>这个命令基本上会把Swift常用的工具都编译出来，不过需要注意的是：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>--playgroundsupport --install-playgroundsupport </span></span>
<span class="line"><span>命令最好是在</span></span>
<span class="line"><span>--swiftpm --install-swiftpm </span></span>
<span class="line"><span>命令之前构建，否则容易出现playgroundsupport构建失败的问题。</span></span>
<span class="line"><span></span></span>
<span class="line"><span>lldb 			依赖 libcxx</span></span>
<span class="line"><span>swiftpm 		依赖 llbuild</span></span>
<span class="line"><span>sourcekit-lsp 	依赖 swiftpm</span></span>
<span class="line"><span>swiftdocc 		依赖 swiftpm</span></span>
<span class="line"><span></span></span>
<span class="line"><span>xctest	在macOS上编译容易出错，并且不需要编译。</span></span>
<span class="line"><span>Swift 官方在 2024 年开始转移 XCTest 的 Darwin 构建到 系统自带的 XCTest.framework，</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>--sourcekit-lsp --install-sourcekit-lsp \\</span></span>
<span class="line"><span>--swiftdocc --install-swiftdocc \\</span></span>
<span class="line"><span>--xctest --install-xctest</span></span>
<span class="line"><span>命令可以移除，应为它们依赖SwiftPM，而SwiftPM运行又依赖macOS13+上面的API,所以会导致这三个命令编译不过。</span></span>
<span class="line"><span></span></span>
<span class="line"><span>最后尝试使用这些编译命令时，可以先一小部分一小部分的编译，这样更容易修补编译时出现的错误。</span></span></code></pre></div><h2 id="-9" tabindex="-1"><a class="header-anchor" href="#-9" aria-label="Permalink to &quot;&quot;">​</a></h2><h2 id="-10" tabindex="-1"><a class="header-anchor" href="#-10" aria-label="Permalink to &quot;&quot;">​</a></h2><h2 id="编译参数相关问题" tabindex="-1">编译参数相关问题 <a class="header-anchor" href="#编译参数相关问题" aria-label="Permalink to &quot;编译参数相关问题&quot;">​</a></h2><ul><li>Release（--release）模式下可能会出现SwiftMacros.DebugDescriptionMacro宏找找不到的情况： <br><strong>原因：</strong> <br> Swift 编译器在 构建标准库阶段 会动态加载 SwiftMacros 宏插件（即 libSwiftMacros.dylib），路径由 -external-plugin-path 指定。例如：<div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>## 示例</span></span>
<span class="line"><span>-external-plugin-path /.../lib/swift/host/plugins#/.../bin/swift-plugin-server</span></span>
<span class="line"><span></span></span>
<span class="line"><span>1. Dead Stripping 或 CMAKE_BUILD_TYPE=Release 会导致：</span></span>
<span class="line"><span>	- CMake 不安装或不复制 host plugins；</span></span>
<span class="line"><span>	- swiftc 构建时剥离 EXTERNAL_PLUGIN_PATH 相关环境；</span></span>
<span class="line"><span>2. Swift 的 bootstrapping 阶段使用独立环境，插件路径不继承；</span></span>
<span class="line"><span>3. swift-plugin-server 在 Release 模式有时未安装在相同层级路径。</span></span></code></pre></div><br><strong>解决方法：</strong> <br> 通过<code>--swift-cmake-options</code>参数设置<code>-DSWIFT_EXTERNAL_PLUGIN_PATH</code>的值即可，示例：<div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ReleaseAssertPath=/Volumes/ExData/Downloads/swift/build/Ninja-ReleaseAssert/swift-macosx-x86_64</span></span>
<span class="line"><span>--swift-cmake-options=&quot;-DSWIFT_EXTERNAL_PLUGIN_PATH=\${ReleaseAssertPath}/bin#\${ReleaseAssertPath}/lib/swift/host/plugins#\${ReleaseAssertPath}/bin/swift-plugin-server&quot; \\</span></span></code></pre></div><br> ⚠️ 注意：路径中的 # 是分隔符，不能换成 : 或空格。<br> ✅ 显式指定宏插件路径（推荐）； 在执行 utils/build-script 时显式传入：<div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span> ReleaseAssertPath=/Volumes/ExData/Downloads/swift/build/Ninja-ReleaseAssert/swift-macosx-x86_64</span></span>
<span class="line"><span> utils/build-script --skip-build-benchmarks \\</span></span>
<span class="line"><span>   --swift-darwin-supported-archs &quot;$(uname -m)&quot; \\</span></span>
<span class="line"><span>   --release --swift-disable-dead-stripping \\</span></span>
<span class="line"><span>   --swift-cmake-options=&quot;-DSWIFT_EXTERNAL_PLUGIN_PATH=\${ReleaseAssertPath}/bin#\${ReleaseAssertPath}/lib/swift/host/plugins#\${ReleaseAssertPath}/bin/swift-plugin-server&quot; \\</span></span>
<span class="line"><span>   --bootstrapping=hosttools</span></span></code></pre></div><br><strong>为什么 –release-debuginfo 可以成功？</strong> 因为它的 CMake 构建类型是：<div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>CMAKE_BUILD_TYPE = RelWithDebInfo</span></span></code></pre></div><br> 这个模式下: <ul><li>保留 debug 信息；</li><li>仍然开启优化；</li><li>关键是 不会剥离宏插件符号和路径；</li><li>所以 Swift 在编译 swiftCore 时能正确加载 SwiftMacros.</li></ul></li></ul><h2 id="-11" tabindex="-1"><a class="header-anchor" href="#-11" aria-label="Permalink to &quot;&quot;">​</a></h2><h2 id="-12" tabindex="-1"><a class="header-anchor" href="#-12" aria-label="Permalink to &quot;&quot;">​</a></h2><h2 id="编译时需要修改的文件" tabindex="-1">编译时需要修改的文件 <a class="header-anchor" href="#编译时需要修改的文件" aria-label="Permalink to &quot;编译时需要修改的文件&quot;">​</a></h2><ul><li>编译<code>llbuild</code>时<code>CMakeLists.txt</code>文件中出现<code>CMP0037</code>错误，这是由cmake版本过高造成的。解决方法有两种:</li></ul><p>第一种：llbuild中全局查找所有的<code>cmake_policy(SET CMP0037 OLD)</code>并将其注释掉即可，如下：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>if(POLICY CMP0037)</span></span>
<span class="line"><span>  #cmake_policy(SET CMP0037 OLD)</span></span>
<span class="line"><span>endif(POLICY CMP0037)</span></span></code></pre></div><p>第二种：降低cmake版本，可以直接重新安装低版本的cmake版本，如果不想重新安装可以下载指定版本cmake，然后编译时传入自定义cmake路径，如下：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>--cmake &quot;/Volumes/ExData/Downloads/dependencies/cmake/3.29.0/bin/cmake&quot;</span></span></code></pre></div><ul><li>编译<code>swiftpm</code>时出现的各种问题，其中包括：<code>-no_warn_duplicate_libraries</code>，<code>ThrottledProgressAnimation.swift</code>，<code>swift-certificates/Sources/X509/PromiseAndFuture.swift</code>错误，解决方法如下：</li></ul><p><code>-no_warn_duplicate_libraries</code>编译指令错误，的修复方法如下：</p><ol><li>进入swiftpm源码目录</li><li>用工具搜索该仓库中<strong>所有代码</strong>中的<code>-no_warn_duplicate_libraries</code></li><li>注释掉<code>-no_warn_duplicate_libraries</code>，如果它的前面出现<code>-Xlinker</code>同时注释掉，示例如下:</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>//linkArguments.append(&quot;-Xlinker&quot;)</span></span>
<span class="line"><span>//linkArguments.append(&quot;-no_warn_duplicate_libraries&quot;)</span></span></code></pre></div><p><code>swiftpm/Sources/Basics/ProgressAnimation/ThrottledProgressAnimation.swift</code>文件中的API不被低于macOS13.0的系统修复方法：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>#if canImport(_Concurrency) &amp;&amp; swift(&gt;=5.7)</span></span>
<span class="line"><span>import _Concurrency</span></span>
<span class="line"><span>// 该区域为原文件中的代码内容</span></span>
<span class="line"><span>@available(macOS 13.0, iOS 16.0, *)</span></span>
<span class="line"><span>final class ThrottledProgressAnimation: ProgressAnimationProtocol {</span></span>
<span class="line"><span>	....</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>@available(macOS 13.0, iOS 16.0, *)</span></span>
<span class="line"><span>extension ProgressAnimationProtocol {</span></span>
<span class="line"><span>	....</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>#else</span></span>
<span class="line"><span>// 在老系统上禁用 throttled 功能</span></span>
<span class="line"><span>extension ProgressAnimationProtocol {</span></span>
<span class="line"><span>  public func throttled(</span></span>
<span class="line"><span>    interval: Double</span></span>
<span class="line"><span>  ) -&gt; some ProgressAnimationProtocol {</span></span>
<span class="line"><span>    self</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>#endif</span></span></code></pre></div><p><code>swift-certificates/Sources/X509/PromiseAndFuture.swift</code>文件中不被识别的<code>_Concurrency</code>，只需要导入<code>_Concurrency</code>即可：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>#if canImport(_Concurrency)</span></span>
<span class="line"><span>import _Concurrency</span></span>
<span class="line"><span>#endif</span></span>
<span class="line"><span></span></span>
<span class="line"><span>//源文件内容</span></span></code></pre></div><ul><li>⚠️警告⚠️： 通过修改<code>swiftpm</code>中的相关源码，可以编译成功，<strong>但是：即使<code>swift package manager</code>被编译成功的，但是它运行时依然要依赖macOS13+的系统库才能正常运行。所以再macOS12下不需要编译<code>swiftpm</code>，并且不能使用<code>swift package manager</code>的相关功能。</strong></li></ul><h2 id="-13" tabindex="-1"><a class="header-anchor" href="#-13" aria-label="Permalink to &quot;&quot;">​</a></h2><h2 id="-14" tabindex="-1"><a class="header-anchor" href="#-14" aria-label="Permalink to &quot;&quot;">​</a></h2><h2 id="关于xctoolchain文件中的info-plist文件生成" tabindex="-1">关于xctoolchain文件中的Info.plist文件生成 <a class="header-anchor" href="#关于xctoolchain文件中的info-plist文件生成" aria-label="Permalink to &quot;关于xctoolchain文件中的Info.plist文件生成&quot;">​</a></h2><p>xctoolchain文件中的<code>Info.plist</code>文件生成，<code>Info.plist</code>文件用于将该工具链导入系统环境，让系统能识别swift的相关工具。</p><p>并且将该工具链导入系统的前提是需要将xxx.xctoolchain文件安装（或创建软连接）到:<code>/Library/Developer/Toolchains/</code>目录：</p><p>Info.plist文件内容示例：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span>
<span class="line"><span>&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;</span></span>
<span class="line"><span>&lt;plist version=&quot;1.0&quot;&gt;</span></span>
<span class="line"><span>&lt;dict&gt;</span></span>
<span class="line"><span>	&lt;key&gt;Aliases&lt;/key&gt;</span></span>
<span class="line"><span>	&lt;array&gt;</span></span>
<span class="line"><span>		&lt;string&gt;swift&lt;/string&gt;</span></span>
<span class="line"><span>	&lt;/array&gt;</span></span>
<span class="line"><span>	&lt;key&gt;CFBundleIdentifier&lt;/key&gt;</span></span>
<span class="line"><span>	&lt;string&gt;org.swift.60020251105&lt;/string&gt;</span></span>
<span class="line"><span>	&lt;key&gt;CompatibilityVersion&lt;/key&gt;</span></span>
<span class="line"><span>	&lt;integer&gt;2&lt;/integer&gt;</span></span>
<span class="line"><span>	&lt;key&gt;CompatibilityVersionDisplayString&lt;/key&gt;</span></span>
<span class="line"><span>	&lt;string&gt;Xcode 8.0&lt;/string&gt;</span></span>
<span class="line"><span>	&lt;key&gt;CreatedDate&lt;/key&gt;</span></span>
<span class="line"><span>	&lt;date&gt;2025-11-05T08:08:08Z&lt;/date&gt;</span></span>
<span class="line"><span>	&lt;key&gt;DisplayName&lt;/key&gt;</span></span>
<span class="line"><span>	&lt;string&gt;Swift 6.0 Release 2025-11-05&lt;/string&gt;</span></span>
<span class="line"><span>	&lt;key&gt;OverrideBuildSettings&lt;/key&gt;</span></span>
<span class="line"><span>	&lt;dict&gt;</span></span>
<span class="line"><span>		&lt;key&gt;ENABLE_BITCODE&lt;/key&gt;</span></span>
<span class="line"><span>		&lt;string&gt;NO&lt;/string&gt;</span></span>
<span class="line"><span>		&lt;key&gt;OTHER_SWIFT_FLAGS&lt;/key&gt;</span></span>
<span class="line"><span>		&lt;string&gt;$(inherited) -plugin-path $(TOOLCHAIN_DIR)/usr/lib/swift/host/plugins&lt;/string&gt;</span></span>
<span class="line"><span>		&lt;key&gt;SWIFT_DEVELOPMENT_TOOLCHAIN&lt;/key&gt;</span></span>
<span class="line"><span>		&lt;string&gt;YES&lt;/string&gt;</span></span>
<span class="line"><span>		&lt;key&gt;SWIFT_DISABLE_REQUIRED_ARCLITE&lt;/key&gt;</span></span>
<span class="line"><span>		&lt;string&gt;YES&lt;/string&gt;</span></span>
<span class="line"><span>		&lt;key&gt;SWIFT_LINK_OBJC_RUNTIME&lt;/key&gt;</span></span>
<span class="line"><span>		&lt;string&gt;YES&lt;/string&gt;</span></span>
<span class="line"><span>		&lt;key&gt;SWIFT_USE_DEVELOPMENT_TOOLCHAIN_RUNTIME&lt;/key&gt;</span></span>
<span class="line"><span>		&lt;string&gt;YES&lt;/string&gt;</span></span>
<span class="line"><span>	&lt;/dict&gt;</span></span>
<span class="line"><span>	&lt;key&gt;ReportProblemURL&lt;/key&gt;</span></span>
<span class="line"><span>	&lt;string&gt;https://bugs.swift.org/&lt;/string&gt;</span></span>
<span class="line"><span>	&lt;key&gt;ShortDisplayName&lt;/key&gt;</span></span>
<span class="line"><span>	&lt;string&gt;Swift 6.0.0 Release&lt;/string&gt;</span></span>
<span class="line"><span>	&lt;key&gt;Version&lt;/key&gt;</span></span>
<span class="line"><span>	&lt;string&gt;6.0.20251105&lt;/string&gt;</span></span>
<span class="line"><span>&lt;/dict&gt;</span></span>
<span class="line"><span>&lt;/plist&gt;</span></span></code></pre></div><h2 id="-15" tabindex="-1"><a class="header-anchor" href="#-15" aria-label="Permalink to &quot;&quot;">​</a></h2><h2 id="-16" tabindex="-1"><a class="header-anchor" href="#-16" aria-label="Permalink to &quot;&quot;">​</a></h2><h2 id="附加-设置动态链接库目录dyld-library-path" tabindex="-1">附加：设置动态链接库目录<code>DYLD_LIBRARY_PATH</code> <a class="header-anchor" href="#附加-设置动态链接库目录dyld-library-path" aria-label="Permalink to &quot;附加：设置动态链接库目录\`\`\`DYLD_LIBRARY_PATH\`\`\`&quot;">​</a></h2><p>示例:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>export DYLD_LIBRARY_PATH=$DYLD_LIBRARY_PATH:/Library/Developer/Toolchains/swift-5.10.1-RELEASE.xctoolchain/usr</span></span>
<span class="line"><span>export DYLD_LIBRARY_PATH=$DYLD_LIBRARY_PATH:/Library/Developer/Toolchains/swift-5.10.1-RELEASE.xctoolchain/usr/lib/</span></span>
<span class="line"><span>export DYLD_LIBRARY_PATH=$DYLD_LIBRARY_PATH:/Library/Developer/Toolchains/swift-5.10.1-RELEASE.xctoolchain/usr/lib/swift/macosx/</span></span></code></pre></div><h2 id="-17" tabindex="-1"><a class="header-anchor" href="#-17" aria-label="Permalink to &quot;&quot;">​</a></h2><h2 id="-18" tabindex="-1"><a class="header-anchor" href="#-18" aria-label="Permalink to &quot;&quot;">​</a></h2><h2 id="-19" tabindex="-1"><a class="header-anchor" href="#-19" aria-label="Permalink to &quot;&quot;">​</a></h2><h2 id="-20" tabindex="-1"><a class="header-anchor" href="#-20" aria-label="Permalink to &quot;&quot;">​</a></h2><h2 id="-21" tabindex="-1"><a class="header-anchor" href="#-21" aria-label="Permalink to &quot;&quot;">​</a></h2><h2 id="-22" tabindex="-1"><a class="header-anchor" href="#-22" aria-label="Permalink to &quot;&quot;">​</a></h2><h2 id="-23" tabindex="-1"><a class="header-anchor" href="#-23" aria-label="Permalink to &quot;&quot;">​</a></h2><h2 id="-24" tabindex="-1"><a class="header-anchor" href="#-24" aria-label="Permalink to &quot;&quot;">​</a></h2>`,103)])])}const g=a(i,[["render",p]]);export{u as __pageData,g as default};
